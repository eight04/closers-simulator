{"version":3,"file":"simulator.worker-5fso17jl.js","sources":["../src/lib/simulator.worker.mjs","../src/lib/simulator.worker.mjs?comlink"],"sourcesContent":["import {luckRates, normalRates} from './data.js';\n\nexport function simulator({\n  simulationCount = 1000,\n  ...args\n} = {}) {\n  const result = {};\n  for (let i = 0; i < simulationCount; i++) {\n    const r = simulateOnce(args);\n    for (const key in r) {\n      result[key] = (result[key] || 0) + r[key];\n    }\n  }\n  for (const key in result) {\n    result[key] = result[key] / simulationCount;\n  }\n  return result;\n}\n\nfunction simulateOnce({currentLevel, targetLevel, hasLuck, maxEnhancementCount, hasProtection}) {\n  const rateTable = hasLuck ? luckRates : normalRates;\n  const r = {};\n  let level = currentLevel;\n  let pity = 0;\n  let i = 0;\n  while (level < targetLevel) {\n    if (rateTable[level].pity != null && pity >= rateTable[level].pity) {\n      level++;\n      pity = 0;\n      continue;\n    }\n    if (maxEnhancementCount != null && i >= maxEnhancementCount) {\n      r.failed = 1;\n      return r;\n    }\n    i++;\n    r[level] = (r[level] || 0) + 1;\n    const rateInfo = rateTable[level];\n    const rand = Math.random() * 10000;\n    let n = 0;\n    let result = 0;\n    for (const key of [-1, 1, 2, 3, 4]) {\n      n += rateInfo[key];\n      if (rand < n) {\n        result = key;\n        break;\n      }\n    }\n    if (result === -1 && !hasProtection) {\n      level--;\n      if (rateTable[level].pity == null) {\n        pity = 0;\n      } else if (pity > rateTable[level].pity) {\n        pity = rateTable[level].pity;\n      }\n    } else if (result >= 1) {\n      level += result;\n      pity = 0;\n    } else if (rateTable[level].pity != null) {\n      pity += hasLuck ? 130 : 100;\n    }\n  }\n  return r;\n}\n","\n\t\timport * as m from \"C:\\\\Users\\\\eight04\\\\dev\\\\closers-simulator\\\\src\\\\lib\\\\simulator.worker.mjs\";\n\t\timport {expose} from \"comlink\";\n\n\t\texpose(m);\n\t"],"names":["simulateOnce","currentLevel","targetLevel","hasLuck","maxEnhancementCount","hasProtection","rateTable","data002","l","r","level","pity","i","failed","rateInfo","rand","Math","random","n","result","key","simulationCount","args","e","m"],"mappings":"yBAmBA,SAASA,GAAaC,aAACA,EAAYC,YAAEA,EAAWC,QAAEA,EAAOC,oBAAEA,EAAmBC,cAAEA,IAC9E,MAAMC,EAAYH,EAAUI,QAAAC,EAAYD,UAClCE,EAAI,CAAA,EACV,IAAIC,EAAQT,EACRU,EAAO,EACPC,EAAI,EACR,KAAOF,EAAQR,GAAa,CAC1B,GAA6B,MAAzBI,EAAUI,GAAOC,MAAgBA,GAAQL,EAAUI,GAAOC,KAAM,CAClED,IACAC,EAAO,EACP,QACF,CACA,GAA2B,MAAvBP,GAA+BQ,GAAKR,EAEtC,OADAK,EAAEI,OAAS,EACJJ,EAETG,IACAH,EAAEC,IAAUD,EAAEC,IAAU,GAAK,EAC7B,MAAMI,EAAWR,EAAUI,GACrBK,EAAuB,IAAhBC,KAAKC,SAClB,IAAIC,EAAI,EACJC,EAAS,EACb,IAAK,MAAMC,IAAO,EAAC,EAAI,EAAG,EAAG,EAAG,GAE9B,GADAF,GAAKJ,EAASM,GACVL,EAAOG,EAAG,CACZC,EAASC,EACT,KACF,MAEED,GAAkBd,EAOXc,GAAU,GACnBT,GAASS,EACTR,EAAO,GAC2B,MAAzBL,EAAUI,GAAOC,OAC1BA,GAAQR,EAAU,IAAM,MAVxBO,IAC6B,MAAzBJ,EAAUI,GAAOC,KACnBA,EAAO,EACEA,EAAOL,EAAUI,GAAOC,OACjCA,EAAOL,EAAUI,GAAOC,MAQ9B,CACA,OAAOF,CACT,+CA7DO,UAAmBY,gBACxBA,EAAkB,OACfC,GACD,IACF,MAAMH,EAAS,CAAA,EACf,IAAK,IAAIP,EAAI,EAAGA,EAAIS,EAAiBT,IAAK,CACxC,MAAMH,EAAIT,EAAasB,GACvB,IAAK,MAAMF,KAAOX,EAChBU,EAAOC,IAAQD,EAAOC,IAAQ,GAAKX,EAAEW,EAEzC,CACA,IAAK,MAAMA,KAAOD,EAChBA,EAAOC,GAAOD,EAAOC,GAAOC,EAE9B,OAAOF,CACT,ICbEZ,QAAAgB,EAAOC"}